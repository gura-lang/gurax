#!/usr/bin/env gurax
import(util.tester) {*}

TestCase('Property') {
	DateTime.PrintPropSlots()
}

TestCase('DateTime.Create()') {
	Tester(`DateTime.Create())
	Tester(`DateTime.Create(2019))
	Tester(`DateTime.Create(2019, 5))
	Tester(`DateTime.Create(2019, 5, 21))
	Tester(`DateTime.Create(2019, 5, 21, 8))
	Tester(`DateTime.Create(2019, 5, 21, 8, 23))
	Tester(`DateTime.Create(2019, 5, 21, 8, 23, 42))
	Tester(`DateTime.Create(2019, 5, 21, 8, 23, 42, 234))
	Tester(`DateTime.Create(2019, 5, 21, 8, 23, 42, 234, 765))
	Tester(`DateTime.Create(2019, 5, nil, 8, nil, 42))
	Tester(`DateTime.Create(2019, nil, nil, nil, nil, 42))
	Tester(`DateTime.Create(year = 2019))
	Tester(`DateTime.Create(month = 5))
	Tester(`DateTime.Create(day = 21))
	Tester(`DateTime.Create(hour = 8))
	Tester(`DateTime.Create(min = 23))
	Tester(`DateTime.Create(sec = 42))
	Tester(`DateTime.Create(msec = 234))
	Tester(`DateTime.Create(usec = 765))
}

TestCase('DateTime.Create() Range Check') {
	Tester(`DateTime.Create(-1))
	Tester(`DateTime.Create(0))
	Tester(`DateTime.Create(9999))
	Tester(`DateTime.Create(10000))
	Tester(`DateTime.Create(nil, 0))
	Tester(`DateTime.Create(nil, 1))
	Tester(`DateTime.Create(nil, 12))
	Tester(`DateTime.Create(nil, 13))
	Tester(`DateTime.Create(nil, nil, 0))
	Tester(`DateTime.Create(nil, nil, 1))
	Tester(`DateTime.Create(nil, nil, 31))
	Tester(`DateTime.Create(nil, nil, 32))
	Tester(`DateTime.Create(nil, nil, nil, -1))
	Tester(`DateTime.Create(nil, nil, nil, 0))
	Tester(`DateTime.Create(nil, nil, nil, 23))
	Tester(`DateTime.Create(nil, nil, nil, 24))
	Tester(`DateTime.Create(nil, nil, nil, nil, -1))
	Tester(`DateTime.Create(nil, nil, nil, nil, 0))
	Tester(`DateTime.Create(nil, nil, nil, nil, 59))
	Tester(`DateTime.Create(nil, nil, nil, nil, 60))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, -1))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, 0))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, 59))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, 60))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, -1))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, 0))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, 999))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, 1000))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, nil, -1))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, nil, 0))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, nil, 999))
	Tester(`DateTime.Create(nil, nil, nil, nil, nil, nil, nil, 1000))
}

TestCase('DateTime - DateTime') {
	Tester(`(DateTime('2000-12-31') - DateTime('2000-1-1')))
	Tester(`(DateTime('2001-12-31') - DateTime('2001-1-1')))
	Tester(`(DateTime('2010-12-31') - DateTime('2010-1-1')))
}

TestCase('DateTime + TimeDelta') {
	Tester(`(DateTime('2000-1-1') + TimeDelta(365)))
	Tester(`(DateTime('2000-1-1') + TimeDelta(366)))
	Tester(`(DateTime('2001-1-1') + TimeDelta(364)))
	Tester(`(DateTime('2001-1-1') + TimeDelta(365)))
	Tester(`(DateTime('2010-1-1') + TimeDelta(364)))
	Tester(`(DateTime('2010-1-1') + TimeDelta(365)))
}

TestCase('DateTime - TimeDelta') {
	Tester(`(DateTime('2000-12-31') - TimeDelta(365)))
	Tester(`(DateTime('2000-12-31') - TimeDelta(366)))
	Tester(`(DateTime('2001-12-31') - TimeDelta(364)))
	Tester(`(DateTime('2001-12-31') - TimeDelta(365)))
	Tester(`(DateTime('2010-12-31') - TimeDelta(364)))
	Tester(`(DateTime('2010-12-31') - TimeDelta(365)))
}

TestCase('Comparison') {
	Println('----')
	Tester(`(DateTime('2010-6-20') == DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-20') != DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-20') < DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-20') <= DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-20') > DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-20') >= DateTime('2010-6-20')))
	Println('----')
	Tester(`(DateTime('2010-6-20') == DateTime('2010-6-21')))
	Tester(`(DateTime('2010-6-20') != DateTime('2010-6-21')))
	Tester(`(DateTime('2010-6-20') < DateTime('2010-6-21')))
	Tester(`(DateTime('2010-6-20') <= DateTime('2010-6-21')))
	Tester(`(DateTime('2010-6-20') > DateTime('2010-6-21')))
	Tester(`(DateTime('2010-6-20') >= DateTime('2010-6-21')))
	Println('----')
	Tester(`(DateTime('2010-6-21') == DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-21') != DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-21') < DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-21') <= DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-21') > DateTime('2010-6-20')))
	Tester(`(DateTime('2010-6-21') >= DateTime('2010-6-20')))
	Println('----')
	Tester(`(DateTime('2010-6-20') == DateTime('2010-7-20')))
	Tester(`(DateTime('2010-6-20') != DateTime('2010-7-20')))
	Tester(`(DateTime('2010-6-20') < DateTime('2010-7-20')))
	Tester(`(DateTime('2010-6-20') <= DateTime('2010-7-20')))
	Tester(`(DateTime('2010-6-20') > DateTime('2010-7-20')))
	Tester(`(DateTime('2010-6-20') >= DateTime('2010-7-20')))
	Println('----')
	Tester(`(DateTime('2010-7-20') == DateTime('2010-6-20')))
	Tester(`(DateTime('2010-7-20') != DateTime('2010-6-20')))
	Tester(`(DateTime('2010-7-20') < DateTime('2010-6-20')))
	Tester(`(DateTime('2010-7-20') <= DateTime('2010-6-20')))
	Tester(`(DateTime('2010-7-20') > DateTime('2010-6-20')))
	Tester(`(DateTime('2010-7-20') >= DateTime('2010-6-20')))
	Println('----')
	Tester(`(DateTime('2010-6-20') == DateTime('2011-6-20')))
	Tester(`(DateTime('2010-6-20') != DateTime('2011-6-20')))
	Tester(`(DateTime('2010-6-20') < DateTime('2011-6-20')))
	Tester(`(DateTime('2010-6-20') <= DateTime('2011-6-20')))
	Tester(`(DateTime('2010-6-20') > DateTime('2011-6-20')))
	Tester(`(DateTime('2010-6-20') >= DateTime('2011-6-20')))
	Println('----')
	Tester(`(DateTime('2011-6-20') == DateTime('2010-6-20')))
	Tester(`(DateTime('2011-6-20') != DateTime('2010-6-20')))
	Tester(`(DateTime('2011-6-20') < DateTime('2010-6-20')))
	Tester(`(DateTime('2011-6-20') <= DateTime('2010-6-20')))
	Tester(`(DateTime('2011-6-20') > DateTime('2010-6-20')))
	Tester(`(DateTime('2011-6-20') >= DateTime('2010-6-20')))
}

TestCase('Property') {
	Println('----')
	Tester(`DateTime.Create(2019, 5, 21, 8, 23, 42, 234, 765)) {|dt|
		Tester(`dt.year)
		Tester(`dt.month)
		Tester(`dt.day)
		Tester(`dt.hour)
		Tester(`dt.min)
		Tester(`dt.sec)
		Tester(`dt.msec)
		Tester(`dt.usec)
		Tester(`dt.minsOff)
		Tester(`dt.wday)
		Tester(`dt.week)
		Tester(`dt.weekShort)
		Tester(`dt.yday)
		Tester(`dt.utc)
	}
	//Tester(`dt.unixTime)
	Println('----')
	Tester(`DateTime.Create(2019, 5, 21, 8, 23, 42, 234, 765, 60 * 9)) {|dt|
		Tester(`dt.minsOff)
		Tester(`dt.utc)
		Tester(`dt.utc.year)
		Tester(`dt.utc.month)
		Tester(`dt.utc.day)
		Tester(`dt.utc.hour)
		Tester(`dt.utc.min)
		Tester(`dt.utc.sec)
		Tester(`dt.utc.msec)
		Tester(`dt.utc.usec)
		Tester(`dt.utc.minsOff)
		Tester(`dt.utc.wday)
		Tester(`dt.utc.week)
		Tester(`dt.utc.weekShort)
		Tester(`dt.utc.yday)
		Tester(`dt.utc.utc)
	}
}

TestCase('DateTime.FromUnixTime()') {
	Tester(`DateTime.FromUnixTime(0):utc)
	Tester(`DateTime.FromUnixTime(100000000):utc)
	Tester(`DateTime.FromUnixTime(1000000000):utc)
	Tester(`DateTime.FromUnixTime(1234567890):utc)
	Tester(`DateTime.FromUnixTime(0x7fffffff):utc)
	Tester(`DateTime.FromUnixTime(0x80000000):utc)
	Tester(`DateTime.FromUnixTime(0xffffffff):utc)
	Tester(`DateTime.FromUnixTime(0x100000000):utc)
	Tester(`DateTime.FromUnixTime(0x700000000):utc)
	Tester(`DateTime.FromUnixTime(100000000).unixTime)
	Tester(`DateTime.FromUnixTime(1000000000).unixTime)
	Tester(`DateTime.FromUnixTime(0x80000000).unixTime)
	Tester(`DateTime.FromUnixTime(0xffffffff).unixTime)
	Tester(`DateTime.FromUnixTime(0x100000000).unixTime)
	Tester(`DateTime.FromUnixTime(0x700000000).unixTime)
}

TestCase('String parser') {
	Tester(`DateTime('Sun, 06 Nov 1994 08:49:37 -0900'))
	Tester(`DateTime('Sun, 06 Nov 1994 08:49:37 +0900'))
	Tester(`DateTime('Sun, 06 Nov 1994 08:49:37 +0845'))
	Tester(`DateTime('Sun, 06 Nov 1994 08:49:37 +1245'))
	Tester(`DateTime('Sun, 06 Nov 1994 08:49:37 -0930'))
	Tester(`DateTime('Sun, 06 Nov 1994 08:49:37 GMT'))
	Tester(`DateTime('Sunday, 06-Nov-94 08:49:37 GMT'))
	Tester(`DateTime('Sun Nov  6 08:49:37 1994'))
	Tester(`DateTime('Sat, 06 Nov 2010 08:49:37 GMT'))
	Tester(`DateTime('Saturday, 06-Nov-10 08:49:37 GMT'))
	Tester(`DateTime('Sat Nov  6 08:49:37 2010'))
	Tester(`DateTime('Wed, 06 Nov 2069 08:49:37 GMT'))
	Tester(`DateTime('Wednesday, 06-Nov-69 08:49:37 GMT'))
	Tester(`DateTime('Wed Nov  6 08:49:37 2069'))
	Tester(`DateTime('Thu, 06 Nov 2070 08:49:37 GMT'))
	Tester(`DateTime('Thursday, 06-Nov-70 08:49:37 GMT'))
	Tester(`DateTime('Sun Nov  6 08:49:37 2070'))
	Tester(`DateTime('Fri Dec 31 23:59:59 9999'))
	Tester(`DateTime('2010-11-06T08:49:37+09:00'))
	Tester(`DateTime('Tue Aug 31 23:54:46 +0000 2010'))
	Tester(`DateTime('2010-1-1'))
	Tester(`DateTime('2010-1-31'))
	Tester(`DateTime('2010-1-0'))
	Tester(`DateTime('2010-1-32'))
	Tester(`DateTime('2010-2-1'))
	Tester(`DateTime('2010-2-28'))
	Tester(`DateTime('2010-2-0'))
	Tester(`DateTime('2010-2-29'))
	Tester(`DateTime('2020-2-1'))
	Tester(`DateTime('2020-2-29'))
	Tester(`DateTime('2020-2-0'))
	Tester(`DateTime('2020-2-30'))
	Tester(`DateTime('2010-3-1'))
	Tester(`DateTime('2010-3-31'))
	Tester(`DateTime('2010-3-0'))
	Tester(`DateTime('2010-3-32'))
	Tester(`DateTime('2010-4-1'))
	Tester(`DateTime('2010-4-30'))
	Tester(`DateTime('2010-4-0'))
	Tester(`DateTime('2010-4-31'))
	Tester(`DateTime('2010-5-1'))
	Tester(`DateTime('2010-5-31'))
	Tester(`DateTime('2010-5-0'))
	Tester(`DateTime('2010-5-32'))
	Tester(`DateTime('2010-6-1'))
	Tester(`DateTime('2010-6-30'))
	Tester(`DateTime('2010-6-0'))
	Tester(`DateTime('2010-6-31'))
	Tester(`DateTime('2010-7-1'))
	Tester(`DateTime('2010-7-31'))
	Tester(`DateTime('2010-7-0'))
	Tester(`DateTime('2010-7-32'))
	Tester(`DateTime('2010-8-1'))
	Tester(`DateTime('2010-8-31'))
	Tester(`DateTime('2010-8-0'))
	Tester(`DateTime('2010-8-32'))
	Tester(`DateTime('2010-9-1'))
	Tester(`DateTime('2010-9-30'))
	Tester(`DateTime('2010-9-0'))
	Tester(`DateTime('2010-9-31'))
	Tester(`DateTime('2010-10-1'))
	Tester(`DateTime('2010-10-31'))
	Tester(`DateTime('2010-10-0'))
	Tester(`DateTime('2010-10-32'))
	Tester(`DateTime('2010-11-1'))
	Tester(`DateTime('2010-11-30'))
	Tester(`DateTime('2010-11-0'))
	Tester(`DateTime('2010-11-31'))
	Tester(`DateTime('2010-12-1'))
	Tester(`DateTime('2010-12-31'))
	Tester(`DateTime('2010-12-0'))
	Tester(`DateTime('2010-12-32'))
	Tester(`DateTime('2010-0-1'))
	Tester(`DateTime('2010-13-1'))
	Tester(`DateTime('2010.9.15'))
	Tester(`DateTime('2010/9/15'))
	Tester(`DateTime('2010-1-1T00:00:00Z'))
	Tester(`DateTime('2010-1-1T23:59:59Z'))
	Tester(`DateTime('2010-1-1T24:00:00Z'))
	Tester(`DateTime('2010-1-1T00:60:00Z'))
	Tester(`DateTime('2010-1-1T00:00:60Z'))
	Tester(`DateTime('2010-1-1 00:00'))
	Tester(`DateTime('2010-1-1 23:59'))
	Tester(`DateTime('2010-1-1 00:00Z'))
	Tester(`DateTime('2010-1-1 00:00+01:00'))
	Tester(`DateTime(''))
	Tester(`DateTime('x'))
	Tester(`DateTime('111'))
	Tester(`DateTime('Sun Dec 31 24:59:59 9999'))
	Tester(`DateTime('Sun Dec 31 003:59:59 2010'))
}

TestSerialization(dateTime as DateTime) = {
	buff = Binary()
	buff.Writer().Serialize(dateTime)
	Printf('%s -> %s\n', dateTime, buff.Reader().Deserialize())
}

TestCase('Serialization') {
	TestSerialization(DateTime.Create())
	TestSerialization(DateTime.Create(2019))
	TestSerialization(DateTime.Create(2019, 5))
	TestSerialization(DateTime.Create(2019, 5, 21))
	TestSerialization(DateTime.Create(2019, 5, 21, 8))
	TestSerialization(DateTime.Create(2019, 5, 21, 8, 23))
	TestSerialization(DateTime.Create(2019, 5, 21, 8, 23, 42))
	TestSerialization(DateTime.Create(2019, 5, 21, 8, 23, 42, 234))
	TestSerialization(DateTime.Create(2019, 5, 21, 8, 23, 42, 234, 765))
	TestSerialization(DateTime.Create(2019, 5, nil, 8, nil, 42))
	TestSerialization(DateTime.Create(2019, nil, nil, nil, nil, 42))
	TestSerialization(DateTime.Create(2019, 5, 21, 8, 23, 42, minsOff = 60 * 9))
}

TestCase('Sort') {
	rand = Random(0)
	dateTimes = DateTime.Create(rand.IntSeq(10) + 2010, rand.IntSeq(12) + 1, rand.IntSeq(28) + 1, rand.IntSeq(24), rand.IntSeq(60), rand.IntSeq(60)).Head(20):list
	Tester(`dateTimes)
	Tester(`dateTimes.Sort())
	Tester(`dateTimes.Sort(`descend))
}
