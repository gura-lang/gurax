#!/usr/bin/env gurax
import(util.tester) {*}


TestCase('Property') {
	Tester(`Binary.__prop__(`bytes))
	Tester(`Binary.__prop__(`p))
	Tester(`Binary.__prop__(`reader))
	Tester(`Binary.__prop__(`writable))
	Tester(`Binary.__prop__(`writer))
}

TestCase('Constructor') {
	Tester(`b'abcdefg')
	Tester(`B'abcdefg')
	Tester(`Binary())
}

TestCase('Binary#writable') {
	Tester(`b'abcdefg'.writable)
	Tester(`B'abcdefg'.writable)
	Tester(`Binary().writable)
}

TestCase('Binary#Reader()') {
	Tester(`b'abcdefg'.Reader())
	Tester(`B'abcdefg'.Reader())
	Tester(`Binary().Reader())
	buff = b'abcdefghijklmnopqrstuvwxyz'
	buff.Reader {|stream|
		stream.Read(8).Dump()
		stream.Read(8).Dump()
		stream.Read(8).Dump()
		stream.Read(8).Dump()
		Println(stream.Read(8))
		stream.Seek(4)
		stream.Read(8).Dump()
		stream.Seek(0)
		while (buff = stream.Read(12)) {
			buff.Dump()
		}
	}
}

TestCase('Binary#Writer()') {
	Tester(`b'abcdefg'.Writer())
	Tester(`B'abcdefg'.Writer())
	Tester(`Binary().Writer())
	buff = Binary()
	buff.Writer {|stream|
		stream.Write(b'abcdefg')
		buff.Dump()
		stream.Write(b'hijklmn')
		buff.Dump()
		stream.Seek(4)
		stream.Write(b'EFGH')
		buff.Dump()
		stream.Write(b'IJKLMNOP')
		buff.Dump()
	}
	buff = B'0123456789'
	buff.Writer {|stream|
		stream.Write(b'abcdefg')
		buff.Dump()
		stream.Write(b'hijklmn')
		buff.Dump()
		stream.Seek(14)
		stream.Write(b'EFGH')
		buff.Dump()
		stream.Write(b'IJKLMNOP')
		buff.Dump()
	}
}
