#!/usr/bin/env gurax
//==============================================================================
// test-diff.gura
//==============================================================================
import(util.tester) {*}
import(diff)
import(conio)

PrintProperty(vtype:VType) = {
	props = vtype.__EachProp__():list
	maxLenSymbolName = [props:*symbol:*name:*len*, 16].Max()
	maxLenVTypeFullName = [props:*vtype:*__fullName__:*len*, 12].Max()
	Printf('%s\n', vtype.__fullName__)
	props.Each {|prop|
		readableFlag = prop.IsSet(`R)
		writableFlag = prop.IsSet(`W)
		Printf('  %-*s %-*s %s\n',
			maxLenSymbolName, prop.symbol.name,
			maxLenVTypeFullName, prop.vtype.__fullName__,
			if (readableFlag && writableFlag) { 'R/W'
			} elsif (readableFlag) { 'R'
			} elsif (writableFlag) { 'W'
			} else { '' })
	}
}
TestCase('Property') {
	PrintProperty(diff.Diff)
	PrintProperty(diff.Edit)
	PrintProperty(diff.Hunk)
}
sys.Exit()
TestCase('') {
	/*
	textOrg = R'''
	This part of the
	document has stayed the
	same from version to
	version.  It shouldn't
	be shown if it doesn't
	change.  Otherwise, that
	would not be helping to
	compress the size of the
	changes.
	
	This paragraph contains
	text that is outdated.
	It will be deleted in the
	near future.
	
	It is important to spell
	check this dokument. On
	the other hand, a
	misspelled word isn't
	the end of the world.
	Nothing in the rest of
	this paragraph needs to
	be changed. Things can
	be added after it.
	'''
	textNew = R'''
	This is an important
	notice! It should
	therefore be located at
	the beginning of this
	document!
	
	This part of the
	document has stayed the
	same from version to
	version.  It shouldn't
	be shown if it doesn't
	change.  Otherwise, that
	would not be helping to
	compress anything.
	
	It is important to spell
	check this document. On
	the other hand, a
	misspelled word isn't
	the end of the world.
	Nothing in the rest of
	this paragraph needs to
	be changed. Things can
	be added after it.
	
	This paragraph contains
	important new additions
	to this document.
	'''
	*/
	textOrg = R'''
	aaaaaaaa
	bbbbbbbb
	cccccccc
	dddddddd
	eeeeeeee
	ffffffff
	gggggggg
	hhhhhhhh
	iiiiiiii
	jjjjjjjj
	kkkkkkkk
	llllllll
	mmmmmmmm
	nnnnnnnn
	oooooooo
	pppppppp
	qqqqqqqq
	rrrrrrrr
	ssssssss
	tttttttt
	uuuuuuuu
	vvvvvvvv
	wwwwwwww
	xxxxxxxx
	yyyyyyyy
	zzzzzzzz
	'''
	textNew = R'''
	aaaaaaaa
	bbbbbbbb
	cccccccc
	ddddddddxxxx
	eeeeeeeexxxx
	ffffffff
	gggggggg
	hhhhhhhh
	XXXX
	iiiiiiii
	jjjjjjjj
	kkkkkkkk
	llllllll
	mmmmmmmm
	nnnnnnnn
	ooooooooxxxx
	ppppppppxxxx
	qqqqqqqqxxxx
	rrrrrrrr
	ssssssss
	tttttttt
	uuuuuuuu
	vvvvvvvv
	wwwwwwww
	XXXX
	xxxxxxxx
	yyyyyyyy
	zzzzzzzz
	'''
	d = diff.Diff(textOrg, textNew)
	Println(d.distance)
	PrintEdits(d.EachEdit())
	// d.EachEdit {|edit|
	// 	Printf('%s %3d %3d %s\n', edit.mark, edit.lineNoOrg, edit.lineNoNew, edit.source)
	// }
	// d.PrintHunks()
/*
	d.EachHunk {|hunk|
		Printf('%s\n', hunk.range)
		Printf('%d\n', hunk.lineNoOrg)
		hunk.Eachedit {|edit|
			Println(edit.mark, ' ', edit.source)
		}
	}
*/
}
